<?php    /*订单管理者(控制器)*/        function __construct()    {        //工具        require "./model/orders_model.php";                //干活        $_GET['a']();    }        //获取收货信息    function info()    {        if(empty($_SESSION['flag'])){  //首先检查用户是否登录了            echo '你还没有登录...';            $_SESSION['to'] = true; // 如果有这个标志,登录后会跳回来            echo "<meta http-equiv=refresh content='2,./index.php?c=enter&a=index' >";            return;        }        require "./view/orders/info.php";        }        //确认订单    function commit()    {        $_SESSION['orders'] = $_POST; //把收货信息 保存到 session 中         require "./view/orders/commit.php";    }        //生成订单    function mkorders()    {                $_GET['tblname'] = 'shop_orders';        $_GET['pk'] = 'oid';        do{            $oid = date('YmdHis').rand(1000,9999);               $condition = " where oid='{$oid}' ";        }while(select($condition));   //确保生成 唯一订单号                $_POST = $_SESSION['orders'];  //构造订单信息        $_POST['otime'] = time();        $_POST['oid'] = $oid;        // echo '<pre>';        // print_r($_POST);die;        // die('1111111111111');        insert();  //插入 订单主表                   if(select($condition)){   //代表插入成功            $_GET['tblname'] = 'shop_detail'; //设置表名            $_GET['pk'] = 'did';  // 设置主键            foreach($_SESSION['cart'] as $k=>$v){                unset($_POST); //清空之前的数据                                $_POST['oid'] = $oid;                $_POST['gid'] = $k;                $_POST['buyprice'] = $v['price'];                $_POST['buycnt'] = $v['cnt'];                                insert(); // 每购物车中的每一种商品  写入到 商品详情表                                $_GET['gid'] = $k; //下面函数的参数                updateGoods('scnt',$v['cnt']); // 改变商品的 销集数                updateGoods('cnt',-$v['cnt']); // 改变商品的 库存            }           echo "下单成功..... 订单号: {$oid}";           echo "<meta http-equiv=refresh content='2,./index.php?c=sns&a=index' >";           unset($_SESSION['cart']); // 下单成功后  清空 购物车        }    }